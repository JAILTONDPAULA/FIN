const request=function({url:a,data:t=null,method:e="get",start:s=!0,callback:l=null}){$.ajax({url:a,type:e,data:t,dataType:"json",beforeSend(){s&&$("#load").css({display:"flex"})},success(a){a.success?l?l(a.cod):$("#load").hide():($("#load").hide(),alert("ERROR"))},error(a,t,e){$("#load").hide();a=a.responseJSON?a.responseJSON.mesage:"Error inesperado";Util.mensagem(a,"ERROR")}})};class Util{static contador(){$(this).siblings("small").find("span").text($(this).attr("maxlength")-this.value.length)}static mensagem(a,t){$("#mensagem").find("h6").text(t),$("#mensagem").find("p").html(a),$("#mensagem").css({display:"flex"}),setTimeout(a=>{$("#mensagem").find("div").slideDown(300)},300)}}class Modal{static open({id:a,html:t,callback:e}){$("#modalDefault form").attr("id",a).html(t),$("#modalDefault").css({display:"flex"}),setTimeout(a=>{$("#modalDefault form").css({transform:"scale(1)"}).find("i").off("click").on({click:Modal.close}),$("#modalDefault .close").off("click").on({click:Modal.close}),e()},300)}static close(){$("#modalDefault form").css({transform:"scale(0)"}),setTimeout(a=>{$("#modalDefault").css({display:"none"}),$("#modalDefault form").attr("id","").html("")},300)}}const buscar=function(){request({url:"http://localhost:84/pessoas",start:!0,callback:function(a){$("table tr:not(.cabecalho)").remove(),$(".valor p").text("0");let e=0;a=a.map((a,t)=>{e++;t=`<tr class="${t%2==0?"":"up"}">`;return(t+=`    <td class="center">${a.name}</td>`)+`    <td class="center">${a.kinship}</td>`+`    <td class="center linkII" data-pessoa='${JSON.stringify(a)}'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20px" height="20px" fill="currentColor"><path d="M7,14.94L13.06,8.88L15.12,10.94L9.06,17H7V14.94M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M16.7,9.35L15.7,10.35L13.65,8.3L14.65,7.3C14.86,7.08 15.21,7.08 15.42,7.3L16.7,8.58C16.92,8.79 16.92,9.14 16.7,9.35M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2" /></svg></td>`+`    <td class="center" data-delete='${JSON.stringify(a)}'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20px" height="20px" fill="currentColor"><path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M16,10V17A1,1 0 0,1 15,18H9A1,1 0 0,1 8,17V10H16M13.5,6L14.5,7H17V9H7V7H9.5L10.5,6H13.5Z" /></svg></td>`+"</tr>"}).join("");$("table").append(a),$("[data-pessoa]").on({click:adicionar}),$("[data-delete]").on({click:exclui}),$("#load").hide(),$(".valor p").text(e)}})},mostrarMensagem=function(){var a=$(this).data("text");Util.mensagem(a,"OBSERVAÇÃO")},adicionar=function(){var a=$(this).is("[data-pessoa]")?$(this).data("pessoa"):null;$.get("/template-pessoa/",a,function(a){Modal.open({id:"pessoas",html:a,callback:function(){$("#pessoas").off("submit").on({submit:salvar})}})})},exclui=function(){var a=$(this).data("delete");$.get("/template-delete/",{id:a.id,registro:a.name},function(a){Modal.open({id:"apagar",html:a,callback:function(){$("#apagar").off("submit").on({submit:apagar})}})})},apagar=function(a){a.preventDefault();request({url:"http://localhost:84/pessoas/"+$("#apagar #id").val(),method:"DELETE",callback:function(a){buscar(),Modal.close()},start:!0})},buscarOrigem=function(){request({url:"http://localhost:84/origem-receitas/descricao",callback:function(a){a=a.map((a,t)=>`<option value="${a}">${a}</option>`).join("");$("#list_origem").html(a)},start:!1})},salvar=function(a){a.preventDefault();a=0<$("#pessoas #id").length?"PUT":"POST";request({url:"http://localhost:84/pessoas",method:a,data:$(this).serialize(),start:!0,callback:function(a){buscar(),Modal.close()}})};$(window).on({load:a=>{buscar(),$("#pessoas>button").on({click:adicionar})}});