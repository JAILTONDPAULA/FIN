const request=function({url:t,data:a=null,method:e="get",start:l=!0,callback:s=null}){$.ajax({url:t,type:e,data:a,dataType:"json",beforeSend(){l&&$("#load").css({display:"flex"})},success(t){t.success?s?s(t.cod):$("#load").hide():($("#load").hide(),alert("ERROR"))},error(){$("#load").hide(),Util.mensagem("Error inesperado","ERROR")}})};class Util{static contador(){$(this).siblings("small").find("span").text($(this).attr("maxlength")-this.value.length)}static mensagem(t,a){$("#mensagem").find("h6").text(a),$("#mensagem").find("p").text(t),$("#mensagem").css({display:"flex"}),setTimeout(t=>{$("#mensagem").find("div").slideDown(300)},300)}}class Modal{static open({id:t,html:a,callback:e}){$("#modalDefault form").attr("id",t).html(a),$("#modalDefault").css({display:"flex"}),setTimeout(t=>{$("#modalDefault form").css({transform:"scale(1)"}).find("i").off("click").on({click:Modal.close}),$("#modalDefault .close").off("click").on({click:Modal.close}),e()},300)}static close(){$("#modalDefault form").css({transform:"scale(0)"}),setTimeout(t=>{$("#modalDefault").css({display:"none"}),$("#modalDefault form").attr("id","").html("")},300)}}const buscar=function(){request({url:"http://localhost:84/receitas",start:!0,callback:function(t){$("table tr:not(.cabecalho)").remove(),$(".valor p").text("R$ 0,00");let e=0;t=t.map((t,a)=>{e+=t.value;a=`<tr class="${a%2==0?"":"up"}">`;return(a+=`    <td>${t.origin.description.toUpperCase()}</td>`)+`    <td class="center">${t.value.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td>`+`    <td class="center">${t.registrationDate.split("-").reverse().join("/")}</td>`+`    <td class="center">${t.year}/${t.month.toString().padStart(2,"0")}</td>`+`    <td class="center">${t.monthly}</td>`+`    <td class="center${t.observation?` link" data-text='${t.observation}'`:'"'}>${t.observation?'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20px" height="20px" fill="currentColor"><path d="M12,3C17.5,3 22,6.58 22,11C22,15.42 17.5,19 12,19C10.76,19 9.57,18.82 8.47,18.5C5.55,21 2,21 2,21C4.33,18.67 4.7,17.1 4.75,16.5C3.05,15.07 2,13.13 2,11C2,6.58 6.5,3 12,3M11,14V16H13V14H11M11,12H13V6H11V12Z" /></svg>':""}</td>`+`    <td class="center linkII" data-receita='${JSON.stringify(t)}'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20px" height="20px" fill="currentColor"><path d="M7,14.94L13.06,8.88L15.12,10.94L9.06,17H7V14.94M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M16.7,9.35L15.7,10.35L13.65,8.3L14.65,7.3C14.86,7.08 15.21,7.08 15.42,7.3L16.7,8.58C16.92,8.79 16.92,9.14 16.7,9.35M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2" /></svg></td>`+`    <td class="center" data-delete='${JSON.stringify(t)}'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20px" height="20px" fill="currentColor"><path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M16,10V17A1,1 0 0,1 15,18H9A1,1 0 0,1 8,17V10H16M13.5,6L14.5,7H17V9H7V7H9.5L10.5,6H13.5Z" /></svg></td>`+"</tr>"}).join("");$("table").append(t),$("[data-text]").on({click:mostrarMensagem}),$("[data-receita]").on({click:adicionar}),$("[data-delete]").on({click:exclui}),$("#load").hide(),$(".valor p").text(e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}))}})},mostrarMensagem=function(){var t=$(this).data("text");Util.mensagem(t,"OBSERVAÇÃO")},adicionar=function(){var t=$(this).is("[data-receita]")?$(this).data("receita"):null;$.get("/template-receita/",t,function(t){Modal.open({id:"receita",html:t,callback:function(){$("#receita").off("submit").on({submit:salvar}),$("textarea").on("paste input",Util.contador),$("#valor").mask("9.999.990,00",{reverse:!0}),buscarOrigem()}})})},exclui=function(){var t=$(this).data("delete");$.get("/template-receita-delete/",t,function(t){Modal.open({id:"apagar",html:t,callback:function(){$("#apagar").off("submit").on({submit:apagarReceita})}})})},apagarReceita=function(t){t.preventDefault();request({url:"http://localhost:84/receitas/"+$("#apagar #id").val(),method:"DELETE",callback:function(t){buscar(),Modal.close()},start:!0})},buscarOrigem=function(){request({url:"http://localhost:84/origem-receitas/descricao",callback:function(t){t=t.map((t,a)=>`<option value="${t}">${t}</option>`).join("");$("#list_origem").html(t)},start:!1})},salvar=function(t){t.preventDefault();t=0<$("#receita #id").length?"PUT":"POST";request({url:"http://localhost:84/receitas",method:t,data:$(this).serialize(),start:!0,callback:function(t){buscar(),Modal.close()}})};$(window).on({load:t=>{buscar(),$("#receitas>button").on({click:adicionar})}});